# class TNode():
#     def __init__(self):
#         self.children = [None] * 26
#         self.idx = -1
#         self.thru = []

# class Trie():
#     def __init__(self):
#         self.root = TNode()
#     def add(self, word, idx):
#         cur = self.root
#         for l in word:
#             cur.thru.append(idx)
#             i = ord(l)-ord('a')
#             if cur.children[i] is None:
#                 cur.children[i] = TNode()
#             cur = cur.children[i]
#         cur.thru.append(idx)
#         cur.idx = idx
#     def check(self, word):
#         def ispal(word): return word == word[::-1]
#         cur, ret = self.root, []
#         if cur.idx >= 0 and ispal(word): ret.append(cur.idx)
#         for idx, l in enumerate(word):
#             cur = cur.children[ord(l)-ord('a')]
#             if cur is None: return ret
#             if cur.idx >= 0 and ispal(word[idx+1:]): ret.append(cur.idx)
#         return ret

class Solution(object):
    def palindromePairs(self, words):
        """
        :type words: List[str]
        :rtype: List[List[int]]
        """
        def ispal(word): return word == word[::-1]
        mapi, ret = {word:idx for idx, word in enumerate(words)}, set([])
        for idx, word in enumerate(words):
            if word == '': continue
            for i in range(1, len(word)):
                if word[:i][::-1] in mapi and ispal(word[i:]):
                    ret.add((idx, mapi[word[:i][::-1]]))
                if word[-i:][::-1] in mapi and ispal(word[:-i]):
                    ret.add((mapi[word[-i:][::-1]], idx))
            if '' in mapi and ispal(word):
                ret.add((mapi[''], idx))
                ret.add((idx, mapi['']))
            if word[::-1] in mapi and idx != mapi[word[::-1]]:
                ret.add((idx, mapi[word[::-1]]))
                ret.add((mapi[word[::-1]], idx))
        return list(ret)
        # rev_tri, tri, ret = Trie(), Trie(), set([])
        # for idx, word in enumerate(words):
        #     rev_tri.add(word[::-1], idx)
        # for idx, word in enumerate(words):
        #     tri.add(word, idx)
        # for idx, word in enumerate(words):
        #     for i in rev_tri.check(word):
        #         if idx != i: ret.add((idx, i))
        #     for j in tri.check(word[::-1]):
        #         if idx != j: ret.add((j, idx))
        # return [[a, b] for a,b in ret]

import time
print time.time()
print Solution().palindromePairs(["dbiddda","eibecaijhda","hcjagjdaccicdcaig","hichh","chjiebfhfdhfgf","ehhcgiidcghfgeieddef","hdcdbabgafbffchbf","ijb","cjhabebfcififdd","fdffefe","idgggffcagjgdbdcf","bjdfgbgbiabbfh","egfdaff","fdfdeb","deadajid","hgceghgahg","gfhfadgabdjh","habfifehdfdccfjihc","bijc","dagehg","efjchch","jbbcjffgfchfa","gedjecggehjidbbdejai","hbfgig","id","hidf","haj","jfjf","jifdjjheagdj","acaahgdd","e","ddjhaibdce","jcijjaiae","chfeeaeijbhdfbbcjgb","igaicajeicjfgeaf","dbeafaf","achhhcgg","ifcecfidec","facjjcbiajbibj","gcjcajbf","jbecfhb","aheha","facgcjeiehcb","bgjgjfbeijbgihedbd","gbg","ahfbaeeeeda","aiaiga","cfgiabh","i","chcadcajj","fijhhbabfibibibb","bjdiijbgijhejhcb","g","ggcchgfjigjhabbhgaf","hfieghfdgaebahf","ebgebjj","gdbaafedhaefdedad","jabfacbbggf","cjhehcggijfihfiib","jjecijjcdedjgbbf","adicfjdgaeabc","hhidebdhgi","bdgebciaab","hbbb","hgagjgffgichbjfe","idccccaifebbhd","jcbbddegdchdged","bbadjcaah","dfhae","jeifgigeccdajd","abjbcdhjbabed","dfccghjbgacfhcj","bjfjecchfjdgf","hjcb","bgghiadjh","gfcfhghea","gb","gj","cbiecjeegdcefdaheba","aigcbjgaibcgie","bifichbebifbgaj","bfcidhiiacbh","hfiicfdjc","cdahhcijecfhbjdedjbf","ghahaeffh","fcbfgjegdhhbgfcd","iajiacfhgeag","ichhdjg","gfibecieabhaceefhj","ahafaebhjfachccfj","aeigaffbgehedeghdbe","afi","gfdchceijeebgciehiid","hgecbcj","igijghhae","gcegfhidbbbeaebbcaeg","gaidjcda","dcaidgihcaciebjb","eajfgjggihggbdijaf","fhjhbfhfchjebaa","j","jaejjed","adifijdiibb","ccjfd","aajcjbbiacfbacedab","hefbfjadhabdacgicc","iahcec","fdbgehigfhefjejefga","fbidiidbcaec","hhcg","diadghgbbiiaffaagb","abiciffabdbgffcgb","cechdihbgbicjjbh","fdcbbadiejfda","giheaaea","ahaedhdb","afdhgaghdie","c","beihdhb","jh","ajgheddebbjbh","dabaidhiehejadg","fh","cedcgb","jdccifabigeagaigcib","efhgebcbgcaia","ahgaahbbbiffeabfe","adjejhgc","fabfdgi","hfehjcadbdeejacage","iifbahdafccidcfijdb","ehfcfiibabeegfi","aaeab","gdhf","fj","fdefh","ibhijcfd","dii","faaffbffj","biaihejbgh","jbejicajejcbjhhd","dhcijdejgiadeijbiba","cfifjjicjhceaagbhabg","dijjfjchjcegigd","hhedcif","ggg","agadcjjjgjbdbghd","fcbfgee","cgia","ddbeib","jjaegffdfaacgbjcbaa","ahfadjigb","eabdgiajbhe","ajbjbhdgifj","fibeebedjfcdddchj","iegagcbi","biabcaa","eidcfhjhjbchjbhcedaj","dhjigchieeebdhaia","hdfh","iffdahif","ge","hfciehcbcjcgdaabjgah","ijghjeaee","ffhjgiibdi","djcfcjajibjeebcghiei","cicdfhigh","ifjdffabcc","ihbhagiddchafchfh","bhdbdefd","hgeeaee","fjicjbigaidaiii","cicgadgcihig","h","addhjgdhdcddjdiibj","aedddiabhdaaaj","cdbdaeaceafgbdbaaida","fbjahfee","ijbcfajegib","bach","eag","hcc","ggc","dbhhedjgcace","fihgajehhcdi","jehhhedbagghcdbebhid","hajcjiegaiffjfgjjji","jgg","gg","fi","a","ff","gjjdhbeagijf","b","ibbhfbdcejhdbjjafh","jhbdbdjcgffjjf","abechgdahigggaf","ihegadghjeeciadg","dfifijgejfgfbiebfjai","f","ejhafcgc","gjjdecadhbaeeifg","iheaiefddhf","ghiaidhagebdbfga","cdjeffidbe","jcbe","ajcagiddacbcfjjicjfi","becfbfiehffdajc","cgbajegfjfjg","cjfcabcajf","cg","bih","cbaggafcgjibefhca","dadbcjjh","cjgfbbijafcjagbc","dcdafcbjbcdbh","ejcgidiedjdcbieegihg","ijhigejjijgejjabedd","bbdfbghgjahdibbib","ididaedfddfj","faiihhhidecdebhdag","ehbfbidgceiegcajfag","fdhbaejgdcbgjbadj","ehjeh","hbadiidgeifcgef","fiadg","fhjab","febfhfjgjbddeb","fg","higjefi","abfcceid","bgabhhdbafcbbjggiadf","hbieejgcccgfca","hedidf","ifghgbahcjdj","gieacfadficd","fcigigbcfdaigjcchb","jdheifdib","chgg","jjeaefggahij","iggacggibe","iddgfigiecjhbaifda","jabadedbfccebjde","cacibeefaajdgief","eachjfgchbdgaghghia","jbhhaegcahcfhdc","ada","bhb","eeeegfiejejh","gbiigdfdjicffbcg","jdhd","ggjhhiejd","bdbjeaagg","gbffhchgc","bbifhcce","jdfcdecddgjb","bifd","dcdbeacdedbeabegd","bcbegbdhiebc","bfdbiahadchb","aihfbafijjjjacjij","hjdeiijch","ib","geghgg","dceejdhjbdgfeedchia","fdbabgehiehecdbiie","afiafgbghd","jacfibibgjehifij","bjchdfdggfghhaeedi","fdjhehjhgcbfda","eidhacgbahi","agcdj","ifgabfgcbbafjcb","edijfdcbcdbhih","ee","habjihcchbjgae","haghjjifighgag","defeaihgaabbjcbea","aaagg","iffefb","icifciehdgf","iiae","jjcjadigeijiajdhfgb","djcbb","fafhbeifjb","fefjhfg","eigcidecfbacfd","jbi","hfdbada","hg","ifagf","diaihddfdgdcbcggdab","igjefdjbadbbcdac","iehffgggbbeea","fbicjega","bgeijiegdhbfbhefi","fbddejdcgjee","bcddgbeagaiibga","bbdbcbi","hhj","ijbjfg","abechadgjbhd","gejidhehe","bbegbgehehdagi","bd","ddejb","bdbjeafichhajcbbci","dijbgfhbejgceeci","dcbaebcgdhbcj","hbbcgab","fhiifdc","fjeghfadagfgfcjbah","bbbejcbb","difiafigghdibhfaiaj","bjbcebadahcccgddah","ddebaibejh","adigajggdcgigdbjed","bgcheghjgecbfhjcfia","bfggecgigefgaefj","aaiefiegg","afiebihcidfijgegbd","ahfacaicciaihcgjhic","dc","fchbibb","ihggccdabhibeigjii","igidijdgg","icababeajbiagf","ffjcaa","afajageecjjhdh","gcdegibdjahcdidgdi","hdgjhihf","d","bbfa","bhchfgegdgfaji","iacijidigbiafbaef","baghchfbgieichheahb","cj","iefjffjgjjig","bjaegjhaecgfijaf","fa","aibfjifhecci","ehijchhacdjihf","cbbgbhaea","bjfdfhihfb","badfeifh","gicchfcabcffjhbaig","heajgchjci","dfjcibcj","gfgjdeceacagfhj","ejieiicghiedhgdeg","ciidhfcfhdhfdbbfeh","dgabajgdaehajdea","ejjgijieeedfhb","eabfeejigcgfg","iafbb","jbfhd","jdcahgiciaehhcafedb","afdigdejbccbdbieidf","djbdehfgdbjbdac","gcgacjfbjbdabhfhfc","gjbfjgc","iegbhc","jigcgiahfaiheaed","jdedcjcccbjgabeebbab","abhbfhgfhff","bjhdiebccgbjfjacdg","ahejfcegcieccf","adcjhgjeig","agcaiicfccbiajigfh","hfgdgjibffjjhbhcg","ahedgdghcbedecdffbca","ebeacbi","addbhf","eiiahheghadfbide","fceihfbbafgcafhhbge","fjgjdjgfghfeebehgbia","jbie","eehdh","eddjfcejhaeaiehc","efaebfaiaabahhhg","icdgjaefdejgebi","jiahegcjdjg","dbfihdchacbhfchfc","iagjjdcgdeajagddfei","jbebfghihfgeh","bcideafi","dhfjfbghjbehijd","ifafbcejhfae","bdcaidcadedjj","jdhjbeifbfhaagbiifff","dicdfgfie","efcgbiiecfghfaeib","affeaa","aeecjgdjjddcde","aadii","jbdcabjhg","ihaebebbggiehcic","jcb","jbagdfbac","dfbecca","gghaebfjhfh","dcdjcjdhbaibc","cagiid","aeaefa","fjehdfhcgedaffdhf","ibcceggihccaejca","dehdjhffggeefeggj","eice","cfcfidb","djejcgddj","fiagbaih","bgfhihefbhchehifff","fhifjjjabeihhegfbidj","ggecccdaegcad","eaeehgfegfjfhhdadj","afjgib","jjjeh","aaafebi","eddjbjcbbjbec","ddjfefbjdei","jbbiadje","aeeejj","fbjffiidgai","aj","hgafabe","jhafcbfijejcjgfaaehc","jficfebgfccfdbd","dhajhdcebc","ggdbh","dhdajbb","jdbbaaggcjdghigd","decdifcbgfdijbghag","djjc","ihcihbgaadfagiidccbf","befifjdbig","jgggj","gfejgiijbe","hbg","eaffbbicaeedcdjggf","gfhfjiahfbgcjjjdcbda","ijjidhj","hbdcebdgbiadeiaiafcc","jfcajeeigdba","eeidaajfdifcjehcaff","hcehifihjdib","bjcaehahfbghcdccga","gjfd","ffihajefb","ghabgiie","ahbiibdei","gihjb","bgcfha","jjbcegbbhihiijg","bebdfajabficdeggb","ediheidhhgcdjhcajec","bdcjfbbjbdfbechch","ihfjhj","gbdecdhchc","hiif","icgefefbdeafggiceid","dbcfjdjbbhaje","bde","adcchefgghaaih","edacdc","eac","ddhbihdghbjafje","bbje","eijdbidfbaefaiiciei","ihdficfehjjhcgaghi","gajaijdjdjf","gjba","bbcciheed","jaebjh","dfcahfjie","dheegeddihicce","afbfdbgg","cajegjifbfhcabai","bdhjjfihj","dgcedgdi","dgicdidjdefdgfejeaij","dedgjaaadich","dghdcdhbibihaigic","gdicgeeddb","bhjiabfhhdbiiih","dicfjihbdaaiacgdd","dacgiihajfia","ajabjdbffjecfhfbii","bdefjjifhhhefjh","abdgeeghc","fcbjjaic","jhjhi","iheacecbcdbfhd","ajabij","fcjcfgidciaid","jdgchhbh","cajfgej","eidbfb","ejgii","gghjaje","dahaigffjcjjh","igife","ajahjb","bjdbbaaaaa","ccdicihdaj","jhjhiaiiifghfggeeajc","jbbejacbehfcgaj","jeejeeifaai","gjdifgjiegeeiedf","cjbehhahiebbbaefig","bhhhaffaeigbhj","bbiie","ijfbjibfbehacgf","ccggceehadbjiejib","ihhegjfaddacgaehcha","ihfedbjjiihjj","bjaadcegdcffgjfddh","gfifceeaefcijebhbcde","ifji","eighbjjhhh","bdd","ffjjgiagidbfcbbgii","heca","ejfjaieecc","eb","idfiafbdjaeaaiad","eiiifcjbichhbhdfic","dhgbbchafejcegbefaj","fhidhjcag","jgeaefce","cfhdecgeehf","adb","ihae","jdb","gdhihdbcbceae","eijjjfacc","hacffhcdg","jffedgjifggeaihgggjb","bejeahdbi","icccegebcijdafabc","cighjdghgjgaceca","ihbahicffhf","ichj","hiiddhicihda","agfbcabcaggdedc","ed","hjcibgadgfaj","iadbbj","hiifjj","bhgfhjjcbb","fdfdjhghjbgghffbfj","ghejhadfd","idiaddjihcgifbfcj","difeebbeafijg","ccgcjaih","cadfjcbdahbjacgg","eifecjddfhgdeedeb","fjchgdbacid","agdjgcjdjcddciccdjj","if","iebcahihicdecaegde","cgagdejehcbea","ddbgejbaddfia","hacadhfbfdhdcjaddaa","fggbgehighcbbbgb","dbha","ddehfgfa","jegfagjdbd","eifjjighffigggdfeeee","jeieggd","cccadiecj","bjieggfcdjaj","icijacd","fhe","idif","didfdjeibefgbj","ecicjifebgibaiefha","jbdbjghdjfgajdfgjfje","bh","bcieiaajadajade","hbjhgghaiegfjcijdagb","hffbdddbdc","chjafd","ijiaj","aejhh","adidjjda","bjcfdjjidbgiagdge","bgbjjhcabdiifd","eehdeadjaaegjcjfcb","ajdb","gbcegaidda","gejhdhaddhcahfaaide","fbf","hidicbefajbighagi","cfcicafefiicjdfe","bjhhad","idfhbed","bagaa","gifhjcjihi","bbcfj","fheifccaigcdbah","hjdfaaaajd","ghafidbjea","jfceghiejehf","edgffecfif","ibiahhbeahhdage","caddibfbjg","jjbiciiihfgbcaii","giihejfjbbddafeigfdg","aghcgh","aibdc","bdhdj","jejcadbhd","hejihaagj","chheifggddhjcchfd","fchhiagdfbee","aaegbhjhied","hhccihahgaighceiiddg","egbfa","bfied","ieddabeghhjaccf","gicigefiafgdjhgb","ccd","hhbjfcfjieaijeh","hajihjjbfddbe","ebebeeejadihcgcecj","igeadfbbiehgfh","jjhej","hfajafhccgggbfhddh","djaigffejhg","hdjdghihjjbghiiidcf","hcfjfieggihfcf","jbbcgcdcjgfejdf","chahih","gecjc","bbfcei","chfghjagdha","ifhec","ffcj","cageaccebgabjagjchae","acjhegag","edaadieabbfdejejbfi","difejifdificfbi","beaiihjjaiihjfggfb","jbfc","ihdegbgfjdjbfhh","gfacbeha","hbafg","cficghcahjjd","ajaeedgefiaja","ddihijfhhidiabcjj","chcfa","egfbgeabeechbg","jjhhfigbabggedj","ddiafcc","ii","cegaj","ddbiefahcaegbig","igadibadddccb","baeadbghdedbgfefj","iebiichaabebehcjci","iabfg","fjgedcccebbcegafedaf","djgfbafbfidifb","jbadgcgfgachcihihced","ejcadadadabeaiijd","ejidbf","gbcige","fbde","jgajceefcdh","ajegjcaggafahbcadf","jhecjjjgijca","abbehjfafbhajafc","gjadeaadhijage","dcfhgdijfdhjeiggdhe","cb","aed","ffahijgg","fajgbdcehidafdfeaa","bg","jai","hefeiieb","fcahbbeacc","didadjhdghiijfjg","bcdbacg","cdhhahdhdi","jgbehbfcdddfei","djhhidhfacbfa","djb","cchidhdhhhfjihbbg","jeigicgac","gafbbdeecaageec","fcffgib","bebdijjacdecbhdbhg","cdhgfdacdeidj","bejabbdagea","hjbb","bfeehi","fdgcbbacfeaagidehgad","iighfjjaa","djjjhfdcbaie","edgaicbbfgaiac","chdcfejbc","jajidhgfai","jccahabfffeeegfiacgc","bffebdgd","cbidjjddciefabbd","ibiaghi","di","abdddc","eadgfdgggdbbgj","jeege","ihbjjgijjdcfhdjji","difddicih","gicibc","fccfdaaddfhj","cggg","jbcebfbhbgabj","dfghfgbej","fdibg","hhhigafcgcibfbi","gbedfachgdejehbjcdg","eghjecd","cgagafgeefdj","cejafefg","babg","bhhjbibgcaecd","bgccbddfe","gfcjiaafefaab","ibdbhj","ihbjiacdfcfabjh","dhgd","bfceehaadhhefe","hgdfgjfefjhgd","adjceffje","gfgdjcicgh","cfajabbbjcbbece","ijegidahbhjc","cdddacgajifj","behjacgdeeehcjihi","ijid","cbjbdabggahbaadifibc","jghiagdhdjacgajf","hfbfjgfiab","caeebciie","gbdjhefccdhbd","haifehgeagdegd","jii","jfjdedegiffadgdc","adbjgachbjeihjadbhdj","jdbhddhgcfhbdhaf","jdjcag","ciabe","ddjdhjjfcfbdjjbgibf","hciijj","bfdae","jfgb","hdjbjbjccgi","iccjcffbaeiggdd","eihiggihchejaj","bcfjfhdjejaehadaai","faciaefeibgbahbjhj","hjgejhcc","bfeghc","gagecadhdgfgib","fehgiif","ifbhcfgafbd","jjf","igfjdddahh","igfcabbfiiccijbjh","hd","fcaig","eedajeaggeefjf","aacefg","gjedfbdaeaadceaa","hhbhjfhfhfebhjg","jag","ihdccagfaaidbfac","gdhdb","aeajchdefhdhajicecbh","hei","gcjhb","bjabjjaheg","ica","gbejdcaeegjcadabbfj","hjgbgdfdbbabh","ibeahgaecjj","eabcah","agebhjcbi","hccce","gdjffh","bfjagajfffh","ahffbeahcabfjje","ggdcfdbcg","caie","ideiagfacdeijbfigbi","ibbeaja","jgf","ifedhifeeacg","jaeegig","dhhbifhbeij","hchddeegddjjdd","cccgbbebbjhiaedgg","jjchbegaageeifdijcb","hcgjacicfjfcbdghdhjb","djjbfci","egfbfdjdchcciddhi","fdjhcihbeifejf","eg","febhhhhggeaiefjbdgfa","cfffeahebieidiecfjg","cagicbabjhffhafef","hejjjbjahida","gabia","fjaefiijecdcijabaf","dcfcd","cabhbdi","eegfhc","eigbgeahdfjjhhfbfhif","fjj","hgjjahaigdaijdhejbb","bjhbdjfiba","abjjbacaa","cbgabahfefaajajggaba","hhfj","hhiiebffieheiejcjf","gffihc","hhgcgdb","achdjedgjidcghhagh","iajcefgfjc","iadagcjheba","fgjgcecbcfi","fbegcfbedcigjd","jadg","aacdhi","gidjejghjgbdg","fadhcihjfeiecdf","ichheciiadfgjaddbbh","bbijgifde","eedbcdijicfaiafadie","dcecbhijbeeabg","bfaghjf","ehgcdffijaae","iacefibbbajde","icbejaghciaihfbghfa","hgfhaccjbgbgcdieeg","eicbidbb","dgee","dhfjfbcaged","dbfbcfjhcccjhfefhbah","gbc","degdeejjjheg","gaacbgjdj","ecdghcfbgbfa","biecbfahfjebcidbchfa","idfehb","diaghejjd","hchbh","chfaeegcefbgeacfccbc","ifaehibaigifbjjjb","fgfbeaaheibajbjfg"])
print time.time()